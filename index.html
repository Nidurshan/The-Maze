<style>
  body {
    margin: 0;
  }
</style>

<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
          }
        }
</script>

<script type="module">
  import * as THREE from 'three'
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js'

  const raycaster = new THREE.Raycaster()
  const scene = new THREE.Scene()
  scene.background = new THREE.Color(0x808080)
  const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  )

  camera.position.set(0, 35, 15)
  camera.rotation.set(-Math.PI / 2, 0, 0)

  const renderer = new THREE.WebGLRenderer()
  // renderer.shadowMap.enabled = true
  renderer.setSize(window.innerWidth, window.innerHeight)
  document.body.appendChild(renderer.domElement)

  const controls = new OrbitControls(camera, renderer.domElement)

  const player = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 32, 32),
    new THREE.MeshStandardMaterial({ color: 0xff0000 })
  )
  // player.castShadow = true
  player.position.y = -1
  player.position.z = 22
  // player.material.color.set(0x0000ff);
  scene.add(player)

  const ground = new THREE.Mesh(
    new THREE.BoxGeometry(10, 1, 50),
    new THREE.MeshStandardMaterial({ color: 0xD3D3D3 })
  )
  // ground.receiveShadow = true
  ground.position.y = -2
  scene.add(ground)

  const light = new THREE.DirectionalLight(0xffffff, 1)
  light.position.y = 5
  light.position.z = 5
  // light.castShadow = true
  scene.add(light)

  const dLight = new THREE.DirectionalLight(0xffffff, 1)
  dLight.position.y = 3
  dLight.position.z = -3
  // dLight.castShadow = true
  scene.add(dLight)

  const aLight = new THREE.AmbientLight(0x404040, 0.5)
  scene.add(aLight)

  const walls = [];

  const wallsData = [
    { width: 6, height: 1.5, depth: 1, positionX: -2, positionY: -1.2, positionZ: 18 },
    { width: 2, height: 1.5, depth: 1, positionX: 4, positionY: -1.2, positionZ: 18 },
    { width: 4, height: 1.5, depth: 1, positionX: 3, positionY: -1.2, positionZ: 15 },
    { width: 4, height: 1.5, depth: 1, positionX: -3, positionY: -1.2, positionZ: 15 },
    { width: 2, height: 1.5, depth: 1, positionX: 4, positionY: -1.2, positionZ: 12 },
    { width: 2, height: 1.5, depth: 1, positionX: -4, positionY: -1.2, positionZ: 12 },
    { width: 2, height: 1.5, depth: 1, positionX: 0, positionY: -1.2, positionZ: 12 },
    { width: 8, height: 1.5, depth: 1, positionX: -1, positionY: -1.2, positionZ: 9 },
    { width: 6, height: 1.5, depth: 1, positionX: 2, positionY: -1.2, positionZ: 6 },
    { width: 2, height: 1.5, depth: 1, positionX: -4, positionY: -1.2, positionZ: 6 },
    { width: 8, height: 1.5, depth: 1, positionX: 1, positionY: -1.2, positionZ: 3 },
    { width: 2, height: 1.5, depth: 1, positionX: 4, positionY: -1.2, positionZ: 0 },
    { width: 2, height: 1.5, depth: 1, positionX: -4, positionY: -1.2, positionZ: 0 },
    { width: 2, height: 1.5, depth: 1, positionX: 0, positionY: -1.2, positionZ: 0 },
    { width: 4, height: 1.5, depth: 1, positionX: 3, positionY: -1.2, positionZ: -3 },
    { width: 4, height: 1.5, depth: 1, positionX: -3, positionY: -1.2, positionZ: -3 },
    { width: 6, height: 1.5, depth: 1, positionX: -2, positionY: -1.2, positionZ: -6 },
    { width: 2, height: 1.5, depth: 1, positionX: 4, positionY: -1.2, positionZ: -6 },
    { width: 4, height: 1.5, depth: 1, positionX: 3, positionY: -1.2, positionZ: -9 },
    { width: 4, height: 1.5, depth: 1, positionX: -3, positionY: -1.2, positionZ: -9 },
    { width: 1, height: 3, depth: 50, positionX: 5.5, positionY: -1, positionZ: 0 },
    { width: 1, height: 3, depth: 50, positionX: -5, positionY: -1, positionZ: 0 }
  ]

  for (let i = 0; i < wallsData.length; i++) {
    var wallObj = wallsData[i];
    const wall = new THREE.Mesh(
      new THREE.BoxGeometry(wallObj.width, wallObj.height, wallObj.depth),
      new THREE.MeshStandardMaterial({ color: 0xD2691E })
    )
    wall.position.x = wallObj.positionX
    wall.position.y = wallObj.positionY
    wall.position.z = wallObj.positionZ
    // wall.castShadow = true
    walls.push(wall);
  }

  // Add walls to the scene by looping
  walls.map(wall => scene.add(wall));

  const homeBox = new THREE.Mesh(
    new THREE.BoxGeometry(4, 4, 4),
    new THREE.MeshStandardMaterial({ color: 0x0000ff })
  )

  const coneGeometry = new THREE.ConeGeometry(2.9, 2.8, 4)
  const coneMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 })
  const homeCone = new THREE.Mesh(coneGeometry, coneMaterial)
  homeCone.position.y = 3.4
  homeCone.rotation.y = 0.8

  const house = new THREE.Group()
  house.add(homeBox)
  house.add(homeCone)
  house.position.z = -18
  scene.add(house)

  const keyState = {}

  window.addEventListener('keydown', (event) => {
    keyState[event.code] = true
  })
  window.addEventListener('keyup', (event) => {
    keyState[event.code] = false
  })


  // Set initial positions for resetting mesh1
  const initialPositionPlayer = new THREE.Vector3(player.position.x, player.position.y, player.position.z);

  function checkCollision() {
    // Check for collision between mesh1 and mesh2
    walls.map(wall => {
      const distance = player.position.distanceTo(wall.position);

      if (distance < 1) {
        // Collision detected, reset mesh1 to initial position
        player.position.copy(initialPositionPlayer);
      }
    })
  }

  // Update function to handle movement and collision
  function update() {

    if (keyState['ArrowUp']) player.position.z -= 0.1
    if (keyState['ArrowDown']) player.position.z += 0.1
    if (keyState['ArrowLeft']) player.position.x -= 0.1
    if (keyState['ArrowRight']) player.position.x += 0.1
    if (keyState['Space']) player.position.y += 0.5

    checkCollision();
  }

  function animate() {
    update();
    renderer.render(scene, camera)
    requestAnimationFrame(animate)
  }
  animate()
</script>