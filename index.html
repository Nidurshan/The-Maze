<style>
  body {
    margin: 0;
    background: whitesmoke;
  }
</style>

<script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.150.1/examples/jsm/"
          }
        }
      </script>

<script type="module">
  import * as THREE from 'three'
  import { OrbitControls } from 'three/addons/controls/OrbitControls.js'

  const scene = new THREE.Scene()
  const camera = new THREE.PerspectiveCamera(
    75,
    window.innerWidth / window.innerHeight,
    0.1,
    1000
  )

  camera.position.set(0, 35, 15)
  camera.rotation.set(-Math.PI / 2, 0, 0)

  const renderer = new THREE.WebGLRenderer()
  renderer.shadowMap.enabled = true
  renderer.setSize(window.innerWidth, window.innerHeight)
  document.body.appendChild(renderer.domElement)

  const controls = new OrbitControls(camera, renderer.domElement)

  const player = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 32, 32),
    new THREE.MeshStandardMaterial({ color: 0xff0000 })
  )
  player.castShadow = true
  player.position.y = -1
  player.position.z = 23
  scene.add(player)

  const ground = new THREE.Mesh(
    new THREE.BoxGeometry(10, 1, 50),
    new THREE.MeshStandardMaterial({ color: 0xD3D3D3 })
  )
  ground.receiveShadow = true
  ground.position.y = -2
  scene.add(ground)

  const light = new THREE.DirectionalLight(0xffffff, 1.2)
  light.position.y = 5
  light.position.z = 5
  light.castShadow = true
  scene.add(light)

  const dLight = new THREE.DirectionalLight(0xffffff, 0.3)
  dLight.position.y = 3
  dLight.position.z = -3
  dLight.castShadow = true
  // scene.add(dLight)

  const walls = [
    { width: 4, height: 1, depth: 1, positionX: 3, positionY: -1.2, positionZ: 4 },
    { width: 4, height: 1, depth: 1, positionX: -3, positionY: -1.2, positionZ: 4 },
    { width: 2, height: 1, depth: 1, positionX: 4, positionY: -1.2, positionZ: 1 },
    { width: 2, height: 1, depth: 1, positionX: -4, positionY: -1.2, positionZ: 1 },
    { width: 2, height: 1, depth: 1, positionX: 0, positionY: -1.2, positionZ: 1 },
    { width: 8, height: 1, depth: 1, positionX: -1, positionY: -1.2, positionZ: -2 },
    { width: 6, height: 1, depth: 1, positionX: 2, positionY: -1.2, positionZ: -5 },
    { width: 2, height: 1, depth: 1, positionX: -4, positionY: -1.2, positionZ: -5 },
    { width: 8, height: 1, depth: 1, positionX: 1, positionY: -1.2, positionZ: -8 },
    { width: 2, height: 1, depth: 1, positionX: 4, positionY: -1.2, positionZ: -11 },
    { width: 2, height: 1, depth: 1, positionX: -4, positionY: -1.2, positionZ: -11 },
    { width: 2, height: 1, depth: 1, positionX: 0, positionY: -1.2, positionZ: -11 }]

  for (let i = 0; i < walls.length; i++) {
    var wallObj = walls[i];
    const wall = new THREE.Mesh(
      new THREE.BoxGeometry(wallObj.width, wallObj.height, wallObj.depth),
      new THREE.MeshStandardMaterial({ color: 0xD2691E })
    )
    wall.position.x = wallObj.positionX
    wall.position.y = wallObj.positionY
    wall.position.z = wallObj.positionZ
    wall.castShadow = true
    scene.add(wall)
  }

  // updateSides() {
  //   this.right = this.position.x + this.width / 2
  //   this.left = this.position.x - this.width / 2

  //   this.bottom = this.position.y - this.height / 2
  //   this.top = this.position.y + this.height / 2

  //   this.front = this.position.z + this.depth / 2
  //   this.back = this.position.z - this.depth / 2
  // }

  function boxCollision({ player, wallObj }) {
    const xCollision = player.right >= wallObj.left && player.left <= wallObj.right
    const yCollision = player.bottom <= wallObj.top && player.top >= wallObj.bottom
    const zCollision = player.front >= wallObj.back && player.back <= wallObj.front

    return xCollision && yCollision && zCollision
  }

  const keyState = {}

  window.addEventListener('keydown', (event) => {
    keyState[event.code] = true
  })
  window.addEventListener('keyup', (event) => {
    keyState[event.code] = false
  })

  function animate() {
    requestAnimationFrame(animate)
    renderer.render(scene, camera)
    if (keyState['ArrowUp']) player.position.z -= 0.1
    if (keyState['ArrowDown']) player.position.z += 0.1
    if (keyState['ArrowLeft']) player.position.x -= 0.1
    if (keyState['ArrowRight']) player.position.x += 0.1
    if (keyState['Space']) player.position.y += 0.5
    // player.position.y += 0.01
    // ground.rotation.y += 0.01
    // player.rotation.y += 0.01
    // player.rotation.y += 0.01
  }
  animate()
</script>